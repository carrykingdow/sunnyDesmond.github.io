---
title: å°ç¨‹åºä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°æˆæƒé—®é¢˜
date: 2018-12-05 08:52:46
keywords:
description: å°ç¨‹åºä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°æˆæƒé—®é¢˜
tags: [å¾®ä¿¡å°ç¨‹åº]
categories: "å¾®ä¿¡å°ç¨‹åº"
---
## é¡¹ç›®éœ€æ±‚
æœ€è¿‘åšä¸€ä¸ªå°ç¨‹åºé¡¹ç›®çš„æ—¶å€™é‡åˆ°äº†ä¿å­˜å›¾ç‰‡åˆ°æ‰‹æœºç›¸å†Œçš„ä¸€ä¸ªåŠŸèƒ½ã€‚å°±åƒè¿™æ ·ï¼š
![éœ€æ±‚å›¾](../img/WX20181205-085624@2x.png)
éœ€è¦é€šè¿‡ç‚¹å‡»ã€ä¿å­˜æŒ‰é’®ã€‘è¿›è¡Œæˆæƒä¿å­˜åˆ°æœ¬åœ°
<!--more-->

## å®˜æ–¹ç¥å‘
å› ä¸ºæµ·æŠ¥å›¾æ˜¯åå°æ¥å£ç»™å‡ºçš„ä¸€ä¸ªurlï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨`wx.downloadFile`è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œç„¶åä½¿ç”¨`wx.saveImageToPhotosAlbum`ä¿å­˜æœ¬åœ°å›¾ç‰‡ã€‚åœ¨æ‰§è¡Œ`wx.saveImageToPhotosAlbum`æ“ä½œçš„æ—¶å€™éœ€è¦ç”¨æˆ·æˆæƒæ“ä½œã€‚
ä½†æ˜¯å¾ˆå‘çš„æ˜¯ï¼Œç”¨æˆ·æ‹’ç»æˆæƒä»¥åï¼Œåœ¨å¼€å‘å·¥å…·å’ŒçœŸæœºä¸Šè¿”å›çš„å›è°ƒä¿¡æ¯æ˜¯ä¸ä¸€æ ·çš„ã€‚ã€‚ã€‚å…¶å®ï¼Œåœ¨ä¸åŒçš„çœŸæœºä¸Šï¼Œè¿”å›ä¿¡æ¯ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ã€‚ğŸ˜‚ğŸ˜‚
failå›è°ƒä¸»è¦è¿”å›è¿™ä¸¤ä¸ªä¿¡æ¯`saveImageToPhotosAlbum:fail:auth denied`å’Œ`saveImageToPhotosAlbum:fail auth deny`ã€‚
æ‰€ä»¥åƒä¸‡ä¸è¦æƒŠè®¶ï¼Œè‡ªå·±çš„å¼€å‘å·¥å…·æ˜¯å¥½çš„ï¼Œè·‘åˆ°çœŸæœºä¸Šå°±ä¸è¡Œäº†ã€‚ã€‚ğŸ˜…ğŸ˜…ï¼Œè¿™ä¸ªå‘ï¼Œå®˜æ–¹ä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•å›åº”ï¼Œè¡¨ç¤ºä¸€åˆ‡ä»¥çœŸæœºä¸ºå‡†ã€‚ã€‚
å› æ­¤éœ€è¦è¿™ä¹ˆè§£å†³ğŸ˜±ğŸ˜±

```
if (err.errMsg === "saveImageToPhotosAlbum:fail:auth denied" || err.errMsg === "saveImageToPhotosAlbum:fail auth deny") {
    .......
}
```
## failå›è°ƒåçš„ä¸€äº›æ“ä½œ
okï¼Œè§£å†³å®Œä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç»™ç”¨æˆ·è¿›è¡Œä¸‹ä¸€æ­¥å¼•å¯¼ã€‚ï¼ˆç”¨æˆ·è¡¨ç¤ºï¼ŒåŠ³èµ„ä¸å°å¿ƒç‚¹äº†æ‹’ç»æˆæƒï¼Œç°åœ¨åŠ³èµ„åˆæƒ³è¦ä¿å­˜å›¾ç‰‡äº†ï¼Œä½†æ˜¯æ‰¾ä¸åˆ°å…¥å£å‘€ã€‚ã€‚ã€‚ï¼‰
é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨`wx.openSetting`è¿›è¡Œç”¨æˆ·å¼•å¯¼ï¼Œå¸®ä»–ä»¬æ‰“å¼€è®¾ç½®ï¼Œè¿›è¡Œç›¸å†Œæˆæƒã€‚ï¼ˆè®©ä½ çš®~ğŸ˜ğŸ˜ï¼‰
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“ä½ åœ¨`fail`å›è°ƒä¸­ç¾æ»‹æ»‹çš„åŠ ä¸Š`wx.openSetting`çš„æ—¶å€™ï¼Œå‘ç°å¹¶ä¸èƒ½è·³è½¬ï¼Œï¼Œè€Œä¸”æˆ‘æµ‹è¯•çš„æ˜¯ï¼Œåœ¨éƒ¨åˆ†æœºå‹å¯ä»¥è·³è½¬ã€‚ï¼ˆæœºå‹æ²¡è®°ã€‚ã€‚ğŸ˜³ï¼‰å¥½æ°”ã€‚
æ‰“å¼€å®˜ç½‘ä¸€çœ‹[ä¸€è¡Œå°å­—](https://developers.weixin.qq.com/minigame/dev/api/wx.openSetting.html?search-key=wx.openSetting)

>>æ³¨æ„ï¼š2.3.0 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·å‘ç”Ÿç‚¹å‡»è¡Œä¸ºåï¼Œæ‰å¯ä»¥è·³è½¬æ‰“å¼€è®¾ç½®é¡µï¼Œç®¡ç†æˆæƒä¿¡æ¯ã€‚

å‘µå‘µï¼Œåˆè¦æ‰‹åŠ¨æˆæƒäº†ã€‚å¥½å§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‰é’®è§¦å‘ï¼Œé‚£ä»€ä¹ˆæŒ‰é’®æ¯”è¾ƒå‹å¥½å‘¢ï¼Ÿæˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯` wx.showModal`ã€‚å“ˆå“ˆå“ˆåœ¨è¿™ä¸ª` wx.showModal`çš„`success`å›è°ƒä¸­åŠ ä¸Š`wx.openSetting`æ•ˆæœå¾ˆæ£’~
è‡³æ­¤ï¼Œè¿™ä¸ªå‘ç»ˆè¸©è¿‡å»äº†ã€‚
å°å°çš„åæ§½ä¸€ä¸‹ï¼Œå…¶å®[wx.previewImage(Object object)](https://developers.weixin.qq.com/miniprogram/dev/api/wx.previewImage.html?search-key=wx.preview)å…¶å®ä¹Ÿè›®é€‚åˆåšæµ·æŠ¥åˆ†äº«çš„ã€‚

>>åœ¨æ–°é¡µé¢ä¸­å…¨å±é¢„è§ˆå›¾ç‰‡ã€‚é¢„è§ˆçš„è¿‡ç¨‹ä¸­ç”¨æˆ·å¯ä»¥è¿›è¡Œä¿å­˜å›¾ç‰‡ã€å‘é€ç»™æœ‹å‹ç­‰æ“ä½œã€‚

å¦‚æœè§‰å¾—æˆæƒæ“ä½œéº»çƒ¦ï¼Œå¯ä»¥æ‹¿å‡ºæ­¤æ­¦å™¨å»æ€¼PM~ğŸ¤“ğŸ¤“ğŸ¤“

## è¯¦ç»†ä»£ç  
æœ€åè´´ä¸Šä»£ç 
```
 <button class='btn'  bindtap='postSave'>ä¿å­˜åˆ°æœ¬åœ°ç›¸å†Œ</button>

```

```
 // ä¿å­˜æµ·æŠ¥
  postSave(e) {
    wx.showLoading({
      title: 'ä¿å­˜ä¸­...'
    })
    wx.downloadFile({
      url: 'http://xxx.com/poster.png',
      success: function (res) {
        //å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°
        wx.saveImageToPhotosAlbum({
          filePath: res.tempFilePath,
          success: function (data) {
            wx.hideLoading()
            wx.showModal({
              title: 'æç¤º',
              content: 'æ‚¨çš„æ¨å¹¿æµ·æŠ¥å·²å­˜å…¥æ‰‹æœºç›¸å†Œï¼Œèµ¶å¿«åˆ†äº«ç»™å¥½å‹å§',
              showCancel:false,
            })
          },
          fail: function (err) {
            if (err.errMsg === "saveImageToPhotosAlbum:fail:auth denied" || err.errMsg === "saveImageToPhotosAlbum:fail auth deny") {
              // è¿™è¾¹å¾®ä¿¡åšè¿‡è°ƒæ•´ï¼Œå¿…é¡»è¦åœ¨æŒ‰é’®ä¸­è§¦å‘ï¼Œå› æ­¤éœ€è¦åœ¨å¼¹æ¡†å›è°ƒä¸­è¿›è¡Œè°ƒç”¨
              wx.showModal({
                title: 'æç¤º',
                content: 'éœ€è¦æ‚¨æˆæƒä¿å­˜ç›¸å†Œ',
                showCancel: false,
                success:modalSuccess=>{
                  wx.openSetting({
                    success(settingdata) {
                      console.log("settingdata", settingdata)
                      if (settingdata.authSetting['scope.writePhotosAlbum']) {
                        wx.showModal({
                          title: 'æç¤º',
                          content: 'è·å–æƒé™æˆåŠŸ,å†æ¬¡ç‚¹å‡»å›¾ç‰‡å³å¯ä¿å­˜',
                          showCancel: false,
                        })
                      } else {
                        wx.showModal({
                          title: 'æç¤º',
                          content: 'è·å–æƒé™å¤±è´¥ï¼Œå°†æ— æ³•ä¿å­˜åˆ°ç›¸å†Œå“¦~',
                          showCancel: false,
                        })
                      }
                    },
                    fail(failData) {
                      console.log("failData",failData)
                    },
                    complete(finishData) {
                      console.log("finishData", finishData)
                    }
                  })
                }
              })
            }
          },
          complete(res) {
            wx.hideLoading()
          }
        })
      }
    })
  }

```











